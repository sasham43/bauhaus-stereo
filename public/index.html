<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8" />
    <title>Raspberry Pi Clock</title>
    <style>
        body {
            display: flex;
            flex-direction: column;
            gap: 18px;
            justify-content: center;
            align-items: center;
            height: 100vh;
            font-family: monospace;
            font-size: 5rem;
            background: #000;            
            
            color: #0f0;

            transform: translateY(-1);
        }

        #info {
            text-align: center;
            font-size: 12px;
            display: none;
        }

        #video {
            display: none;
            position: absolute;
            inset: 0;
            width: 100%;
            height: 100%;
        }
    </style>
</head>

<body>
    <div id="clock">--:--</div>
    <div id="info">

    </div>
    <!-- <div> -->
    <video id="video">
    </video>
    <!-- </div> -->


    <script>
        let clockElement, infoElement, videoElement;

        function updateClock() {
            const now = new Date();
            const hh = String(now.getHours()).padStart(2, '0');
            const mm = String(now.getMinutes()).padStart(2, '0');
            clockElement = document.getElementById('clock')//?.textContent = `${hh}:${mm}`;

            if(clockElement){
                clockElement.textContent  = `${hh}:${mm}`;
            }
        }
        async function fetchStatus() {
            try {
                const res = await fetch('/api/status');
                const data = await res.json();

                infoElement = document.getElementById('info')
                videoElement = document.getElementById('video')
                clockElement = document.getElementById('clock')
                // document.getElementById('info').textContent =
                //     `Mode: ${data.mode} | Color: ${data.color} | Video: ${data.video}`;

                if(infoElement){
                    infoElement.textContent = `Color: ${data.color} | Video: ${data.video}`;
                }

                const {color, video} = data;

                if(color && clockElement){
                    clockElement.style.color = color;
                }
                if(color && infoElement){
                    infoElement.style.color = color;
                }

                if(video && videoElement){
                    videoElement.src = `/videos/${video}`
                    video.style.display = 'block'
                }
            } catch (err) {
                console.error(err)
                if(infoElement){
                    infoElement.textContent = 'Status: offline';
                }
            }
        }

        fetchStatus();
        updateClock();
        setInterval(updateClock, 1000);
    </script>
</body>

</html>